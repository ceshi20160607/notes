(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{485:function(a,s,t){"use strict";t.r(s);var e=t(0),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"一、环境安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、环境安装"}},[a._v("#")]),a._v(" 一、环境安装")]),a._v(" "),s("p",[s("strong",[a._v("前置条件：准备一台4核16G及以上的服务器或者虚拟机")])]),a._v(" "),s("h4",{attrs:{id:"安装java环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装java环境"}},[a._v("#")]),a._v(" 安装java环境")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("      yum -y install java-1.8.0-openjdk-devel;\n")])])]),s("h4",{attrs:{id:"安装redis环境并设置开机自启"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装redis环境并设置开机自启"}},[a._v("#")]),a._v(" 安装redis环境并设置开机自启")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("      yum -y install epel-release;\n      yum -y install redis;\n      chkconfig redis on;\n      #-- 修改redis密码为123456\n      yum -y install vim;\n      vim /etc/redis.conf;\n      #-- 在文件最下面追加一行\n      requirepass 123456\n      #-- 或者输入 / 搜索 # requirepass foobared\n      #-- 将前面的#删除，将foobared改为123456\n      #-- 修改完成之后 :wq 保存并退出,重启redis\n      service redis restart;\n")])])]),s("h4",{attrs:{id:"安装maven环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装maven环境"}},[a._v("#")]),a._v(" 安装maven环境")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  yum -y install maven;\n")])])]),s("h4",{attrs:{id:"安装mysql8-0数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql8-0数据库"}},[a._v("#")]),a._v(" 安装mysql8.0数据库")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v(' #-- 1.由于centOS7中默认安装了MariaDB,需要先进行卸载\n  rpm -qa | grep -i mariadb\n  rpm -e --nodeps mariadb-libs-5.5.64-1.el7.x86_64\n # -- 查询下本机mysql是否卸载干净\n  rpm -qa | grep mysql\n  yum -y install wget;\n  wget https://repo.mysql.com//mysql80-community-release-el7-3.noarch.rpm\n  yum -y install mysql80-community-release-el7-3.noarch.rpm\n  yum -y install mysql-community-server --nogpgcheck\n  sudo systemctl start mysqld.service;\n  sudo systemctl enable mysqld.service;\n\n  #--查看安装的mysql默认密码,如下图所示\n\n  grep "password" /var/log/mysqld.log\n')])])]),s("p",[s("img",{attrs:{src:"https://images.gitee.com/uploads/images/2021/0207/143052_5000d9e4_8065912.jpeg",alt:"查询mysql默认密码",title:"查询mysql默认密码"}})]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #--进入mysql 例：mysql -u root -p\"GXOO%eiI/7o>\"\n  mysql - u root -p\"此处为上一步的默认密码\"\n\n  #--修改mysql密码，如下图所示\n  set global validate_password_policy=LOW;\n  ALTER USER 'root'@'localhost' IDENTIFIED BY 'password';\n")])])]),s("p",[s("img",{attrs:{src:"https://images.gitee.com/uploads/images/2021/0207/143854_76cd7719_8065912.jpeg",alt:"修改mysql默认密码",title:"修改mysql默认密码"}})]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #--退出\n  exit\n\n  #--修改mysql配置\n  vim /etc/my.cnf;\n\n  #--输入 i 进入编辑模式，修改sql_mode设置，如下图所示，将下面sql_mode配置复制，到 [mysqld]下使用 shift+insert 粘贴\n  sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION\n")])])]),s("p",[s("img",{attrs:{src:"https://images.gitee.com/uploads/images/2021/0207/144304_d0d350b6_8065912.jpeg",alt:"修改mysql配置",title:"修改mysql配置"}})]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #--修改完毕，按esc按键，然后 :wq 保存并退出，重启mysql\n  service mysqld restart;\n")])])]),s("h4",{attrs:{id:"安装elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装elasticsearch"}},[a._v("#")]),a._v(" 安装elasticsearch")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #-- 在opt目录下安装\n  cd /opt;\n\n  #-- 下载elasticsearch6.8.6\n  wget https://file.72crm.com/static/elasticsearch-6.8.6.zip;\n\n  #-- 下载analysis-icu-6.8.6分词器插件\n  wget https://file.72crm.com/static/analysis-icu-6.8.6.zip;\n\n  #--下载unzip\n  yum -y install unzip\n\n  #--解压刚才下载的elasticsearch\n  unzip elasticsearch-6.8.6.zip\n  \n  #--将分词器插件解压到elasticsearch/plugins目录下\n  unzip analysis-icu-6.8.6.zip -d elasticsearch-6.8.6/plugins/analysis-icu-6.8.6;\n\n  #--创建elasticsearch用户\n  useradd elasticsearch;\n\n  #--赋予用户目录权限\n  chown -R elasticsearch:elasticsearch elasticsearch-6.8.6;\n\n  #--切换至elasticsearch用户\n  su elasticsearch\n\n  #--启动\n  cd elasticsearch-6.8.6/bin\n  ./elasticsearch -d\n  #--退出elasticsearch用户\n  exit\n")])])]),s("h4",{attrs:{id:"下载其他依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载其他依赖"}},[a._v("#")]),a._v(" 下载其他依赖")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #--在opt目录下安装\n  cd /opt;\n  #--下载nacos\n  wget https://github.com/alibaba/nacos/releases/download/2.0.3/nacos-server-2.0.3.tar.gz\n  #--解压nacos到opt目录\n  tar -zxvf nacos-server-2.0.3.tar.gz ;\n\n  #--下载seata\n  wget https://github.com/seata/seata/releases/download/v1.4.2/seata-server-1.4.2.tar.gz\n  #--解压seata到opt目录\n  tar -zxvf seata-server-1.4.2.tar.gz\n\n  #--下载sentinel\n  wget https://file.72crm.com/static/sentinel-dashboard-1.7.2.jar;\n  #--将sentinel放到指定目录\n  mkdir /opt/sentinel;\n  mv sentinel-dashboard-1.7.2.jar /opt/sentinel/sentinel.jar;\n\n  #--删除已解压的zip文件\n  rm -rf nacos-server-2.0.3.tar.gz ;\n  rm -rf seata-server-1.4.2.tar.gz\n")])])]),s("h4",{attrs:{id:"上传源码或已经打包好的package"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传源码或已经打包好的package"}},[a._v("#")]),a._v(" 上传源码或已经打包好的package")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v(" #--假设源码文件：wukongcrm上传到/opt木目录下，\n \n  cd /opt/wukongcrm/\n  #--打包，第一次打包会比较慢，请耐心等待\n  mvn clean -Dmaven.test.skip=true package;\n\n  #-- 创建package文件夹\n  mkdir /opt/package;\n\n  #--将打包后代码复制到一个目录，方便统一管理\n  cp admin/target/admin.zip /opt/package;\n  cp authorization/target/authorization.zip /opt/package;\n  cp crm/target/crm.zip /opt/package;\n  cp gateway/target/gateway.zip /opt/package;\n  cp bi/target/bi.zip /opt/package;\n  cp examine/target/examine.zip /opt/package;\n  cp oa/target/oa.zip /opt/package;\n  cp work/target/work.zip /opt/package;\n  cp job/target/job.zip /opt/package;\n  #-- 如果打包好的zip jar 包，直接进行解压\n  #-- 解压对应文件\n  cd /opt/package;\n  unzip admin.zip -d admin;\n  unzip authorization.zip -d authorization;\n  unzip crm.zip -d crm;\n  unzip gateway.zip  -d gateway;\n  unzip bi.zip -d bi;\n  unzip examine.zip -d examine;\n  unzip oa.zip -d oa;\n  unzip work.zip -d work;\n  unzip job.zip -d job;\n  \n  #-- 导入数据库信息\n  #-- 进入数据库\n  mysql -uroot -ppassword\n")])])]),s("h4",{attrs:{id:"修改配置信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置信息"}},[a._v("#")]),a._v(" 修改配置信息")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #-- 创建nacos数据库\n  create database wk_crm_nacos character set utf8mb4 collate utf8mb4_general_ci;\n  use wk_crm_nacos;\n  source /opt/wukongcrm/DB/wk_crm_nacos.sql;\n\n  #-- 创建seata数据库\n  create database seata character set utf8mb4 collate utf8mb4_general_ci;\n  use seata;\n  source /opt/wukongcrm/DB/seata.sql;\n\n  #-- 创建xxl_job数据库\n  create database xxl_job character set utf8mb4 collate utf8mb4_general_ci;\n  use xxl_job;\n  source /opt/wukongcrm/DB/xxl_job.sql;\n\n  #-- 创建crm数据库\n  create database wk_crm_table character set utf8mb4 collate utf8mb4_general_ci;\n  use wk_crm_table ;\n  source /opt/wukongcrm/DB/wk_crm_table.sql;\n\n  #-- 退出数据库\n  exit;\n\n  #-- 修改nacos持久化到DB\n\n  cd /opt/nacos/conf;\n  vim application.properties;\n  #-- 按 i 进入编辑模式，将 以下配置文件取消注释，如下图所示\n  #-- spring.datasource.platform  db.num  db.url.0    db.user    db.password\n")])])]),s("p",[s("img",{attrs:{src:"https://images.gitee.com/uploads/images/2021/0510/150022_fc5d41e5_8065912.png",alt:"输入图片说明",title:"edit_nacos.png"}})]),a._v(" "),s("h6",{attrs:{id:""}},[s("a",{staticClass:"header-anchor",attrs:{href:"#"}},[a._v("#")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v('  #-- 修改完成之后 :wq 保存并退出\n  #-- 启动nacos\n  cd /opt/nacos/bin\n  sh startup.sh -m standalone\n  \n  #-- 配置seata持久化到nacos\n  cd /opt/seata/conf/;\n  vim registry.conf;\n  #-- 按 i 进入编辑模块，将registry{} 和 config{}下的type="file" 改为 type="nacos"\n  #-- 修改完成之后 :wq 保存并退出,然后启动seata服务\n  cd /opt/seata/bin;\n  nohup sh seata-server.sh > log.out 2>&1 &\n\n  #-- 启动sentinel\n  cd /opt/sentinel;\n  nohup java -Xms128m -Xmx512m -Dserver.port=8079 -Dproject.name=sentinel-dashboard -jar sentinel.jar &\n \n  #-- 下载xxl-job 2.1.2版本\n  cd /opt\n  git clone -b 2.1.2 https://gitee.com/xuxueli0323/xxl-job.git\n  cd xxl-job;\n  修改xxl-job的配置文件\n  vim xxl-job-admin/src/main/resources/application.properties\n  #-- 按 i 进入编辑模块，将server.port改为7070\n  #-- 修改spring.datasource.url，spring.datasource.username,spring.datasource.password参数，如下图所示\n')])])]),s("p",[s("img",{attrs:{src:"https://images.gitee.com/uploads/images/2021/0510/162025_3ffb9cfb_8065912.png",alt:"输入图片说明",title:"edit_xxl_job.png"}})]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  #-- 修改完成之后 :wq 保存并退出,执行打包流程\n  mvn clean -Dmaven.test.skip=true package;\n  #-- 启动xxl-job-admin\n  mkdir /opt/xxl-job-admin;\n  cp xxl-job-admin/target/xxl-job-admin-2.1.2.jar /opt/xxl-job-admin\n  cd /opt/xxl-job-admin/\n  nohup java -Xms128m -Xmx512m -jar xxl-job-admin-2.1.2.jar> log.out 2>&1 &\n")])])]),s("h4",{attrs:{id:"启动项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动项目"}},[a._v("#")]),a._v(" 启动项目")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("  cd /opt/package/admin/ && sh 72crm.sh start;\n  cd /opt/package/authorization/ && sh 72crm.sh start;\n  cd /opt/package/crm/ && sh 72crm.sh start;\n  cd /opt/package/gateway/ && sh 72crm.sh start;\n  cd /opt/package/bi/ && sh 72crm.sh start;\n  cd /opt/package/examine/ && sh 72crm.sh start;\n  cd /opt/package/oa/ && sh 72crm.sh start;\n  cd /opt/package/work/ && sh 72crm.sh start;\n  cd /opt/package/job/ && sh 72crm.sh start;\n\n  #-- 项目启动完成\n")])])]),s("h4",{attrs:{id:"-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#-2"}},[a._v("#")])]),a._v(" "),s("h4",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[a._v("#")]),a._v(" 注意事项")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v(" #-- 启动命令可以写成sh脚本，方便下次重启\n #-- 项目对应模块的解压，打包，运行可以搞成批处理脚本\n #-- 72crm项目启动失败，错误日志在/opt/package/对应模块/logs下面\n #-- 如更改前端文件，需替换前端文件，在前端打包完成后，将打包生成的dist文件夹放到gateway模块下，重命名为public\n #-- cd 前端文件目录 \n #-- rm -rf /opt/package/gateway/public\n #-- cp -R dist /opt/package/gateway/public\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);